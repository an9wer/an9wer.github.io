<!DOCTYPE html>
<html lang="zh-Hans">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta name="generator" content="Docutils 0.18: http://docutils.sourceforge.net/" />
<title>Sed</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="stylesheet" href="/statics/css/style.css" type="text/css" />
<link rel="alternate" type="application/rss+xml" title="Subscribe to an9wer's blog" href="/blog.rss" />
<link rel="icon" href="/statics/images/icon.jpg" type="image/jpeg" size="32x32" />
</head>

<body>
  <div id="main">

    <div id="header">
      <div id="headerLeft">
        <div id="name"><a href="/blog.html">an9wer's blog</a></div>
        <div id="signature">Just stick to it :)</div>
      </div> <!-- headerLeft -->
      <div id="headerRight">
        <div id="avatar"><img src="/statics/images/avatar.jpg"></div>
      </div> <!-- headerRight -->
    </div> <!-- header -->

    <div id="navbar">
      <a id="blog" href="/blog.html">Blog</a>
      <a id="moments" href="/moments.html">Moments</a>
      <a id="notes" class="current" href="/notes.html">Notes</a>
      <a id="tools" href="/tools.html">Tools</a>
    </div> <!-- navbar -->

<h1 class="title">Sed</h1>
<dl class="docinfo simple">
<dt class="updated">Updated<span class="colon">:</span></dt>
<dd class="updated"><p>: 2021/05/18</p>
</dd>
</dl>

    <div id="content">
<p>sed 的基本语法如下:</p>
<pre class="literal-block">sed [options ... ] [address]command[command options] [inputfile ...]</pre>
<p>sed 可以同时执行多条命令，用换行符或者用分号分隔，或者使用多个 <span class="docutils literal"><span class="pre">-e</span></span> 参数：</p>
<pre class="literal-block">$ sed '/^foo/d; s/hello/world/'
$ sed -e '/^foo/d' -e 's/hellow/world/'
$ sed -f &lt;(echo &quot;/^foo/d; s/hello/world/&quot;)
$ sed -f &lt;(echo -e &quot;/^foo/d\ns/hello/world/&quot;)</pre>
<p>sed 在运行的时候，内部维护了两个 buffer，一个是 <a class="reference internal" href="#pattern-space">pattern space</a> ，另一个是 <a class="reference internal" href="#hold-space">hold space</a> 。
sed 每次只能对一行数据进行处理，每次处理的时候会把整行的内容塞到 pattern space 中，
如果有必要的话，再通过 'h', 'H', 'g', 'G' 等命令保存到 hold space 中，
等处理完操作下一行的数据时又会清空这两个 buffer 中的内容。</p>
<section id="addresses">
<h2>1. Addresses</h2>
<p>如果只有一个 address，表示该 address 匹配到的行。
如果有两个 address，并用逗号分隔，表示从第一个 address 到第二个 address 匹配到的范围。</p>
<section id="number-addresses">
<h3>1.1 Number addresses</h3>
<dl>
<dt><span class="docutils literal">NUMBER</span></dt>
<dd><p>Specifying a line number will match only that line in the input.</p>
<pre class="literal-block">$ seq 3 | sed -n '2p'
2</pre>
</dd>
<dt><span class="docutils literal">$</span></dt>
<dd><p>Matches the last line of the last file of input.</p>
<pre class="literal-block">$ seq 3 | sed -n '$p'
3</pre>
</dd>
<dt><span class="docutils literal">FIRST~STEP</span></dt>
<dd><p>Matches every STEPth line starting with line FIRST.</p>
<pre class="literal-block">$ seq 3 | sed -n '1~2p'
1
3</pre>
</dd>
</dl>
</section>
<section id="regex-addresses">
<h3>1.2 Regex addresses</h3>
<dl>
<dt><span class="docutils literal">/REGEXP/</span> (The '/' may be replaced by any other single character.)</dt>
<dd><p>Matches the regular expression REGEXP.</p>
<pre class="literal-block">$ seq 3 | sed -n '/^[0-2]$/p'
1
2</pre>
</dd>
</dl>
</section>
</section>
<section id="commands">
<h2>2. Commands</h2>
<p><strong>Note</strong>: 为了便于理解，在使用的时候加上 <span class="docutils literal"><span class="pre">--debug</span></span> 参数可以看到 sed 的执行步骤。</p>
<section id="common-commands">
<h3>2.1 Common commands</h3>
<dl>
<dt><span class="docutils literal">a &lt;TEXT&gt;</span></dt>
<dd><p>Append &lt;TEXT&gt; after line.</p>
<pre class="literal-block">$ seq 2 | sed 'a a'
1
a
2
a</pre>
</dd>
<dt><span class="docutils literal">i &lt;TEXT&gt;</span></dt>
<dd><p>Insert &lt;TEXT&gt; before a line.</p>
<pre class="literal-block">$ seq 2 | sed 'i i'
i
1
i
2</pre>
</dd>
<dt><span class="docutils literal">c &lt;TEXT&gt;</span></dt>
<dd><p>Replace lines with &lt;TEXT&gt;.</p>
<pre class="literal-block">$ seq 3 | sed '2 c c'
1
c
3</pre>
</dd>
<dt><span class="docutils literal">d</span></dt>
<dd><p>Delete the <a class="reference internal" href="#pattern-space">pattern space</a>; immediately start next cycle.</p>
<pre class="literal-block">$ seq 3 | sed '2d'
1
3</pre>
</dd>
<dt><span class="docutils literal">p</span></dt>
<dd><p>Print out the pattern space.</p>
<pre class="literal-block">$ seq 3 | sed -n '2p'
2</pre>
</dd>
<dt><span class="docutils literal">N</span></dt>
<dd><p>Add a newline to the pattern space, then append the next line of input to
the pattern space. If there is no more input then 'sed' exits without
processing any more commands.</p>
<pre class="literal-block">$ seq 3 | sed -n 'N; p'
1
2</pre>
</dd>
</dl>
</section>
<section id="hold-space-commands">
<h3>2.2 Hold space commands</h3>
<dl class="simple">
<dt><span class="docutils literal">g</span></dt>
<dd><p>Replace the contents of the pattern space with the contents of the hold
space.</p>
</dd>
<dt><span class="docutils literal">G</span></dt>
<dd><p>Append a newline to the contents of the pattern space, and then append the
contents of the hold space to that of the pattern space.</p>
</dd>
<dt><span class="docutils literal">h</span></dt>
<dd><p>(hold) Replace the contents of the hold space with the contents of the
pattern space.</p>
</dd>
<dt><span class="docutils literal">H</span></dt>
<dd><p>Append a newline to the contents of the hold space, and then append the
contents of the pattern space to that of the hold space.</p>
</dd>
</dl>
</section>
</section>
<section id="branching-and-flow-control-commands">
<h2>2.3 Branching and flow Control commands</h2>
<p>首先需要了解下 <a class="reference internal" href="#label">label</a> ，label 即在 sed 代码中打上一个标记，稍后可以通过下面的三个命令进行跳转，有点类似 C 的 goto 语句。</p>
<dl>
<dt><span class="docutils literal">b [&lt;LABLE&gt;]</span></dt>
<dd><p>不管怎么样，马上跳转到 label</p>
<pre class="literal-block">$ seq 3 | sed -n 's/2/b/; b ; p'
&lt;return nothing&gt;</pre>
</dd>
<dt><span class="docutils literal">t [&lt;LABEL&gt;]</span></dt>
<dd><p>如果有 <span class="docutils literal"><span class="pre">s///</span></span> 命令执行成功，则立马跳转到 label</p>
<pre class="literal-block">$ seq 3 | sed -n 's/2/b/; t ; p'
1
3</pre>
</dd>
<dt><span class="docutils literal">T [&lt;LABEL&gt;]</span></dt>
<dd><p>如果 <span class="docutils literal"><span class="pre">s///</span></span> 命令没有执行成功，则立马跳转到 label</p>
<pre class="literal-block">$ seq 3 | sed -n 's/2/b/; T ; p'
b</pre>
</dd>
</dl>
</section>
<section id="basic-bre-and-extended-ere-regular-expression">
<h2>2.4 Basic (BRE) and extended (ERE) regular expression</h2>
<p>BRE 和 ERE 的唯一区别是 <span class="docutils literal">? + () {} |</span> 这几个特殊字符，
在 BRE 中需要加上 '' 前缀在能有特殊含义（例如 '?', '(', ')' 等），而在 ERE 中不需要这么做，其本身就又特殊含义。</p>
</section>
<section id="named-classes-of-characters-in-bracket-expressions">
<h2>2.5 Named classes of characters in bracket expressions</h2>
<p><strong>Note</strong>: These named classes must be used <em>inside</em> brackets themselves.</p>
<p>Incorrect example:</p>
<pre class="literal-block">$ echo 1 | sed 's/[:digit:]/X/'
sed: character class syntax is [[:space:]], not [:space:]</pre>
<p>Correct example:</p>
<pre class="literal-block">$ echo 1 | sed 's/[[:digit:]]/X/'
X</pre>
</section>
<section id="references">
<h2>References</h2>
<dl class="simple" id="pattern-space">
<dt>patter space</dt>
<dd><p>On every cycle, 'sed' reads one line from the input stream, removes any
trailing newline, and places it in the pattern space.  Then all commands
are executed and print the contents of pattern space to the output stream,
adding back the trailing newline if it was removed. Then the next cycle
starts for the next input line. Unless special commands (like 'D') are
used, the pattern space is deleted between two cycles.</p>
</dd>
</dl>
<dl class="simple" id="hold-space">
<dt>hold space</dt>
<dd><p>On the other hand, keeps its data between cycles (see commands 'h', 'H',
'x', 'g', 'G' to move data between both buffers).</p>
</dd>
</dl>
<dl class="simple" id="label">
<dt>label</dt>
<dd><p>Labels are defined with a colon followed by one or more letters (e.g.
':x').  If the label is omitted the branch commands restart the cycle.</p>
</dd>
</dl>
<p>To find more details in <span class="docutils literal">info sed</span>.</p>
</section>
    </div> <!-- content -->

    <div id="footer">
      <a href="https://creativecommons.org/licenses/by-nc-sa/3.0/" target="_blank">CC BY-NC-SA</a> 2018-2021 an9wer | powered by <a href="http://docutils.sourceforge.net/" target="_blank">docutils</a>
    </div> <!-- footer -->

  </div> <!-- main -->

  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-141786049-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'UA-141786049-1');
  </script>

</body>
</html>
